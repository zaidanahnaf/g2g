<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G2G Logic Test</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <h1>G2G Backend JS Logic Test</h1>

    <h2>Test Add Offer</h2>
    <form id="offerForm">
        <input type="text" id="offerName" placeholder="Nama" value="Test Cafe">
        <input type="text" id="offerArea" placeholder="Area" value="Bekasi">
        <input type="text" id="offerAmount" placeholder="Jumlah" value="1kg">
        <button type="submit">Add Offer</button>
    </form>
    <hr>

    <h2>Test List Offers</h2>
    <button id="loadOffersBtn">Load Offers</button>
    <ul id="offersList"></ul>
    <hr>

    <h2>Test Guide Progress</h2>
    <label>
        <input type="checkbox" id="step1"> Step 1 Completed
    </label><br>
    <label>
        <input type="checkbox" id="step2"> Step 2 Completed
    </label><br>
    <label>
        <input type="checkbox" id="step3"> Step 3 Completed
    </label><br>
    <button id="saveGuideProgress">Save Progress</button>
    <p>Current Progress: <span id="currentProgressStatus"></span></p>

    <script type="module" src="js/offerLogic.js"></script>
    <script type="module" src="js/guideLogic.js"></script>

    <script type="module">
        // Import fungsi-fungsi dari offerLogic.js dan guideLogic.js
        import { addCoffeeOffer, getAllCoffeeOffers } from './js/offerLogic.js';
        import { updateStepCompletion, getGuideProgress } from './js/guideLogic.js';

        // --- TEST ADD OFFER ---
        const offerForm = document.getElementById('offerForm');
        if (offerForm) { // Pastikan elemen ditemukan
            offerForm.addEventListener('submit', function(event) {
                event.preventDefault(); // Mencegah reload halaman
                const offerData = {
                    name: document.getElementById('offerName').value,
                    type: 'Kafe', // Untuk testing, type bisa di-hardcode atau tambahkan input
                    area: document.getElementById('offerArea').value,
                    amount: document.getElementById('offerAmount').value,
                    contact: 'dummy_contact' // Untuk testing
                };
                addCoffeeOffer(offerData);
                console.log('Offer data added:', offerData);
                alert('Offer added! Check console and try Load Offers.');
                // Opsional: kosongkan form setelah submit
                offerForm.reset();
                displayOffers(); // Refresh daftar setelah menambah
            });
        }

        // --- TEST LIST OFFERS ---
        const loadOffersBtn = document.getElementById('loadOffersBtn');
        const offersList = document.getElementById('offersList');

        if (loadOffersBtn) { // Pastikan elemen ditemukan
            loadOffersBtn.addEventListener('click', displayOffers);
        }

        function displayOffers() {
            const offers = getAllCoffeeOffers();
            offersList.innerHTML = ''; // Hapus daftar sebelumnya
            if (offers.length === 0) {
                offersList.innerHTML = '<li>No offers available yet.</li>';
                return;
            }
            offers.forEach(offer => {
                const li = document.createElement('li');
                li.textContent = `${offer.name} (${offer.type}, ${offer.amount}) - Area: ${offer.area}`;
                offersList.appendChild(li);
            });
            console.log('Current offers loaded:', offers);
        }

        // Opsional: Load offers secara otomatis saat halaman pertama kali dimuat
        document.addEventListener('DOMContentLoaded', displayOffers);


        // --- TEST GUIDE PROGRESS ---
        const step1Checkbox = document.getElementById('step1');
        const step2Checkbox = document.getElementById('step2');
        const step3Checkbox = document.getElementById('step3'); // Jika Anda menambahkan step 3
        const saveGuideProgressBtn = document.getElementById('saveGuideProgress');
        const currentProgressStatus = document.getElementById('currentProgressStatus');

        // Fungsi untuk memuat status checkbox dari guideLogic saat halaman dimuat
        function loadInitialGuideState() {
            const progress = getGuideProgress(); // Mengambil status dari guideLogic.js (yang sudah load dari localStorage)
            if (step1Checkbox) step1Checkbox.checked = progress.step1Completed;
            if (step2Checkbox) step2Checkbox.checked = progress.step2Completed;
            if (step3Checkbox) step3Checkbox.checked = progress.step3Completed || false; // default false jika belum ada

            updateProgressStatus(); // Update teks status
            console.log('Initial guide state loaded from guideLogic:', progress);
        }

        // Fungsi untuk mengupdate teks status progres
        function updateProgressStatus() {
            const progress = getGuideProgress(); // Ambil status terbaru
            const completedSteps = Object.values(progress).filter(value => value === true).length;
            const totalSteps = Object.keys(progress).length; // Menghitung total langkah yang ada di objek progress
            currentProgressStatus.textContent = `${completedSteps} dari ${totalSteps} langkah selesai.`;
            console.log(`Progress: ${completedSteps}/${totalSteps}`);
        }

        if (saveGuideProgressBtn) { // Pastikan elemen ditemukan
            saveGuideProgressBtn.addEventListener('click', function() {
                if (step1Checkbox) updateStepCompletion('step1Completed', step1Checkbox.checked);
                if (step2Checkbox) updateStepCompletion('step2Completed', step2Checkbox.checked);
                if (step3Checkbox) updateStepCompletion('step3Completed', step3Checkbox.checked); // Simpan status step 3

                updateProgressStatus(); // Perbarui tampilan status setelah menyimpan
                alert('Progres panduan disimpan!');
            });
        }

        // Panggil fungsi inisialisasi saat DOM sudah siap
        document.addEventListener('DOMContentLoaded', loadInitialGuideState);

    </script>
</body>
</html>